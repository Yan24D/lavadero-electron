<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Sistema de Gesti√≥n para Lavadero de Autos - Panel Secretario</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="../assets/css/styles.css">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="javascript:void(0)">
                <i class="fas fa-car-wash me-2"></i>Clean Car - Panel Secretario
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="javascript:void(0)">
                            <i class="fas fa-calendar-day me-1"></i>
                            <span id="currentDate"></span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="javascript:void(0)">
                            <i class="fas fa-clock me-1"></i>
                            <span id="currentTime"></span>
                        </a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user-circle me-1"></i><span id="userName">Secretario</span>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#"><i class="fas fa-user me-2"></i>Mi Perfil</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="login.html"><i class="fas fa-sign-out-alt me-2"></i>Cerrar Sesi√≥n</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content Container -->
    <div class="container mt-4">
        <div class="mainCard">
            <!-- Tab Navigation -->
            <div class="tabHeader">
                <ul class="nav nav-tabs" id="mainTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="registerTab" data-bs-toggle="tab" data-bs-target="#registerPanel" type="button" role="tab">
                            <i class="fas fa-plus-circle me-2"></i>Registrar Veh√≠culo
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="searchTab" data-bs-toggle="tab" data-bs-target="#searchPanel" type="button" role="tab">
                            <i class="fas fa-search me-2"></i>Consultar Historial
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="reportsTab" data-bs-toggle="tab" data-bs-target="#reportsPanel" type="button" role="tab">
                            <i class="fas fa-cash-register me-2"></i>Cierre de Caja
                            <span class="badge bg-primary rounded-pill ms-2" id="dailyCountBadge">0</span>
                        </button>
                    </li>
                </ul>
            </div>

            <!-- Tab Content -->
            <div class="tabBody">
                <div class="tab-content" id="mainTabContent">
                    
                    <!-- Register Panel -->
                    <div class="tab-pane fade show active" id="registerPanel" role="tabpanel">
                        <h4 class="sectionTitle">Nuevo Registro de Servicio</h4>
                        
                        <!-- Quick Services -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="quickServicesCard">
                                    <div class="cardHeader">
                                        <h5 class="cardTitle">Servicios Disponibles</h5>
                                        <small class="text-muted">Haga clic para seleccionar r√°pidamente</small>
                                    </div>
                                    <div class="cardBody">
                                        <div class="row" id="quickServicesContainer">
                                            <!-- Los servicios se cargan din√°micamente desde la BD -->
                                            <div class="col-lg-3 col-md-6 mb-3">
                                                <div class="serviceQuickCard" data-service-id="" data-price="">
                                                    <div class="serviceIcon">
                                                        <i class="fas fa-spinner fa-spin"></i>
                                                    </div>
                                                    <h6>Cargando...</h6>
                                                    <p class="servicePrice">$0</p>
                                                    <small class="text-muted">Servicios</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Service Registration Form -->
                        <form id="serviceForm" novalidate>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="inputGroup">
                                        <label for="serviceDate" class="inputLabel">
                                            <i class="fas fa-calendar-alt me-1"></i>Fecha
                                        </label>
                                        <input type="text" class="form-control" id="serviceDate" readonly>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="inputGroup">
                                        <label for="serviceTime" class="inputLabel">
                                            <i class="fas fa-clock me-1"></i>Hora
                                        </label>
                                        <input type="text" class="form-control" id="serviceTime" readonly>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="inputGroup">
                                        <label for="vehicleType" class="inputLabel">
                                            <i class="fas fa-car me-1"></i>Tipo de Veh√≠culo *
                                        </label>
                                        <select class="form-select" id="vehicleType" required>
                                            <option value="" selected disabled>Seleccione el tipo de veh√≠culo</option>
                                            <option value="car">üöó Autom√≥vil</option>
                                            <option value="pickup">üöô Camioneta</option>
                                            <option value="suv">üöê SUV</option>
                                            <option value="motorcycle">üèçÔ∏è Motocicleta</option>
                                            <option value="truck">üöõ Cami√≥n</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="inputGroup">
                                        <label for="licensePlate" class="inputLabel">
                                            <i class="fas fa-id-card me-1"></i>Placa del Veh√≠culo *
                                        </label>
                                        <input type="text" class="form-control text-uppercase" id="licensePlate" 
                                               placeholder="ABC-123" required maxlength="10" autocomplete="off">
                                        <div class="invalid-feedback">
                                            Por favor ingrese una placa v√°lida
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-8">
                                    <div class="inputGroup">
                                        <label for="serviceType" class="inputLabel">
                                            <i class="fas fa-tools me-1"></i>Tipo de Servicio *
                                        </label>
                                        <select class="form-select" id="serviceType" required>
                                            <option value="" selected disabled>Seleccione el servicio</option>
                                            <!-- Se llena din√°micamente desde la BD -->
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="col-md-4">
                                    <div class="inputGroup">
                                        <label for="serviceCost" class="inputLabel">
                                            <i class="fas fa-dollar-sign me-1"></i>Costo ($) *
                                        </label>
                                        <input type="number" class="form-control" id="serviceCost" 
                                               min="0" step="0.01" required placeholder="0.00">
                                        <div class="invalid-feedback">
                                            El costo debe ser mayor a 0
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-8">
                                    <div class="inputGroup">
                                        <label for="washerSelect" class="inputLabel">
                                            <i class="fas fa-user me-1"></i>Lavador Asignado *
                                        </label>
                                        <select class="form-select" id="washerSelect" required>
                                            <option value="" selected disabled>Seleccione el lavador</option>
                                            <!-- Se llena din√°micamente desde la BD -->
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="col-md-4">
                                    <div class="inputGroup">
                                        <label for="commissionPercent" class="inputLabel">
                                            <i class="fas fa-percentage me-1"></i>Comisi√≥n (%) *
                                        </label>
                                        <input type="number" class="form-control" id="commissionPercent" 
                                               value="30" min="0" max="100" required>
                                        <small class="text-muted" id="commissionDisplay">Comisi√≥n: $0.00</small>
                                    </div>
                                </div>
                                
                                <div class="col-12">
                                    <div class="inputGroup">
                                        <label for="serviceNotes" class="inputLabel">
                                            <i class="fas fa-sticky-note me-1"></i>Observaciones
                                        </label>
                                        <textarea class="form-control" id="serviceNotes" rows="3" 
                                                  placeholder="Detalles adicionales, condiciones especiales, etc."></textarea>
                                    </div>
                                </div>
                                
                                <div class="col-12">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="paymentCompleted">
                                        <label class="form-check-label" for="paymentCompleted">
                                            <i class="fas fa-money-bill-wave me-1"></i>
                                            <strong>Pago Realizado</strong>
                                            <small class="text-muted d-block">Marque si el cliente ya pag√≥ el servicio</small>
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="col-12 mt-4">
                                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                        <button type="reset" class="btn btn-outline-secondary actionBtn">
                                            <i class="fas fa-times me-2"></i>Limpiar Formulario
                                        </button>
                                        <button type="submit" class="btn btn-primary actionBtn">
                                            <i class="fas fa-save me-2"></i>Guardar Registro
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- Search Panel -->
                    <div class="tab-pane fade" id="searchPanel" role="tabpanel">
                        <h4 class="sectionTitle">Consultar Historial de Veh√≠culos</h4>
                        
                        <!-- Search Filters -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h6 class="card-title mb-0">
                                            <i class="fas fa-filter me-2"></i>Filtros de B√∫squeda
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row g-3">
                                            <div class="col-md-3">
                                                <div class="inputGroup">
                                                    <label for="searchPlate" class="inputLabel">Buscar por Placa</label>
                                                    <input type="text" class="form-control text-uppercase" id="searchPlate" 
                                                           placeholder="ABC-123" autocomplete="off">
                                                    <small class="text-muted">B√∫squeda parcial permitida</small>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="inputGroup">
                                                    <label for="searchDate" class="inputLabel">Fecha Espec√≠fica</label>
                                                    <input type="date" class="form-control" id="searchDate">
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="inputGroup">
                                                    <label for="searchService" class="inputLabel">Tipo de Servicio</label>
                                                    <select class="form-select" id="searchService">
                                                        <option value="">Todos los servicios</option>
                                                        <!-- Se llena din√°micamente -->
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="inputGroup">
                                                    <label class="inputLabel">&nbsp;</label>
                                                    <div class="d-grid gap-2">
                                                        <button class="btn btn-primary" id="searchBtn">
                                                            <i class="fas fa-search me-2"></i>Buscar
                                                        </button>
                                                        <button class="btn btn-outline-secondary btn-sm" onclick="secretario.limpiarBusqueda()">
                                                            <i class="fas fa-eraser me-1"></i>Limpiar
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Search Results -->
                        <div class="historyCard">
                            <div class="cardHeader">
                                <h5 class="cardTitle">
                                    <i class="fas fa-list me-2"></i>Resultados de B√∫squeda
                                    <span class="badge bg-info ms-2" id="searchResultsCount">0</span>
                                </h5>
                                <div class="exportButtons">
                                    <button class="btn btn-sm btn-outline-success me-2" id="exportSearchBtn">
                                        <i class="fas fa-file-excel me-1"></i>Exportar
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger" id="printSearchBtn">
                                        <i class="fas fa-print me-1"></i>Imprimir
                                    </button>
                                </div>
                            </div>
                            <div class="cardBody">
                                <div class="tableContainer">
                                    <table class="table table-striped table-hover dataTable">
                                        <thead class="tableHeader">
                                            <tr>
                                                <th><i class="fas fa-clock me-1"></i>Fecha/Hora</th>
                                                <th><i class="fas fa-id-card me-1"></i>Placa</th>
                                                <th><i class="fas fa-car me-1"></i>Veh√≠culo</th>
                                                <th><i class="fas fa-tools me-1"></i>Servicio</th>
                                                <th><i class="fas fa-dollar-sign me-1"></i>Costo</th>
                                                <th><i class="fas fa-user me-1"></i>Lavador</th>
                                                <th><i class="fas fa-credit-card me-1"></i>Estado</th>
                                                <th><i class="fas fa-cogs me-1"></i>Acciones</th>
                                            </tr>
                                        </thead>
                                        <tbody id="searchResults">
                                            <tr>
                                                <td colspan="8" class="emptyState">
                                                    <i class="fas fa-search fa-2x mb-2 d-block"></i>
                                                    Use los filtros para buscar registros en el historial
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Reports Panel -->
                    <div class="tab-pane fade" id="reportsPanel" role="tabpanel">
                        <div class="reportHeader">
                            <h4 class="sectionTitle">Cierre de Caja Diario</h4>
                            <div class="d-flex gap-2 flex-wrap">
                                <button class="btn btn-outline-success actionBtn" id="exportDailyBtn">
                                    <i class="fas fa-file-excel me-2"></i>Exportar CSV
                                </button>
                                <button class="btn btn-outline-danger actionBtn" id="printDailyBtn">
                                    <i class="fas fa-print me-2"></i>Imprimir Reporte
                                </button>
                                <button class="btn btn-outline-info actionBtn" onclick="secretario.cargarRegistrosDelDia()">
                                    <i class="fas fa-sync-alt me-2"></i>Actualizar
                                </button>
                            </div>
                        </div>

                        <!-- Daily Summary Cards -->
                        <div class="row mb-4">
                            <div class="col-lg-3 col-md-6 mb-3">
                                <div class="summaryCard totalRevenue">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <p class="summaryLabel">Ingresos del D√≠a</p>
                                            <h3 class="summaryValue" id="dailyRevenue">$0</h3>
                                        </div>
                                        <div class="summaryIcon">
                                            <i class="fas fa-cash-register"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-lg-3 col-md-6 mb-3">
                                <div class="summaryCard totalCommissions">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <p class="summaryLabel">Total Comisiones</p>
                                            <h3 class="summaryValue" id="dailyCommissions">$0</h3>
                                        </div>
                                        <div class="summaryIcon">
                                            <i class="fas fa-percentage"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-lg-3 col-md-6 mb-3">
                                <div class="summaryCard netBalance">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <p class="summaryLabel">Balance Neto</p>
                                            <h3 class="summaryValue" id="dailyNet">$0</h3>
                                        </div>
                                        <div class="summaryIcon">
                                            <i class="fas fa-chart-line"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-lg-3 col-md-6 mb-3">
                                <div class="summaryCard">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <p class="summaryLabel">Servicios Realizados</p>
                                            <h3 class="summaryValue" id="dailyServices">0</h3>
                                        </div>
                                        <div class="summaryIcon">
                                            <i class="fas fa-tasks"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Daily Records Table -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h6 class="card-title mb-0">
                                    <i class="fas fa-table me-2"></i>Registros del D√≠a - <span id="currentDateDisplay"></span>
                                </h6>
                            </div>
                            <div class="card-body p-0">
                                <div class="tableContainer">
                                    <table class="table table-striped table-hover dataTable mb-0">
                                        <thead class="tableHeader">
                                            <tr>
                                                <th><i class="fas fa-clock me-1"></i>Hora</th>
                                                <th><i class="fas fa-car me-1"></i>Veh√≠culo</th>
                                                <th><i class="fas fa-id-card me-1"></i>Placa</th>
                                                <th><i class="fas fa-tools me-1"></i>Servicio</th>
                                                <th><i class="fas fa-dollar-sign me-1"></i>Costo</th>
                                                <th><i class="fas fa-percentage me-1"></i>Comisi√≥n</th>
                                                <th><i class="fas fa-user me-1"></i>Lavador</th>
                                                <th><i class="fas fa-credit-card me-1"></i>Estado</th>
                                                <th><i class="fas fa-cogs me-1"></i>Acciones</th>
                                            </tr>
                                        </thead>
                                        <tbody id="dailyRecords">
                                            <tr>
                                                <td colspan="9" class="emptyState">
                                                    <div class="py-4">
                                                        <i class="fas fa-calendar-day fa-3x mb-3 text-muted d-block"></i>
                                                        <h5 class="text-muted">No hay registros para el d√≠a de hoy</h5>
                                                        <p class="text-muted mb-0">Los nuevos registros aparecer√°n aqu√≠ autom√°ticamente</p>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Performance Statistics -->
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <div class="performanceCard">
                                    <div class="cardHeader">
                                        <h5 class="cardTitle">
                                            <i class="fas fa-users me-2"></i>Rendimiento por Lavador
                                        </h5>
                                    </div>
                                    <div class="cardBody">
                                        <div class="washer-stats" id="washerStats">
                                            <div class="text-center text-muted py-3">
                                                <i class="fas fa-chart-bar fa-2x mb-2"></i>
                                                <p class="mb-0">Las estad√≠sticas se mostrar√°n cuando haya registros del d√≠a</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6 mb-4">
                                <div class="serviceCard">
                                    <div class="cardHeader">
                                        <h5 class="cardTitle">
                                            <i class="fas fa-star me-2"></i>Servicios M√°s Solicitados
                                        </h5>
                                    </div>
                                    <div class="cardBody">
                                        <div class="service-stats" id="serviceStats">
                                            <div class="text-center text-muted py-3">
                                                <i class="fas fa-chart-pie fa-2x mb-2"></i>
                                                <p class="mb-0">Los servicios m√°s populares se mostrar√°n aqu√≠</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="appFooter">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <p class="mb-0">¬© 2024 Sistema de Gesti√≥n - Lavadero de Autos</p>
                </div>
                <div class="col-md-6 text-end">
                    <p class="mb-0">Versi√≥n 1.0.0 | Panel Secretario</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Notifications Container -->
    <div id="notifications" class="notificationContainer"></div>

    <!-- Loading Overlay (se crea din√°micamente) -->

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/es.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!-- Nuestro JavaScript espec√≠fico para secretario -->
    <script src="../assets/js/secretario.js"></script>
    
    <script>
        // Actualizar fecha actual en el reporte
        document.addEventListener('DOMContentLoaded', function() {
            const currentDateDisplay = document.getElementById('currentDateDisplay');
            if (currentDateDisplay) {
                const today = new Date();
                currentDateDisplay.textContent = today.toLocaleDateString('es-ES', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            }
        });

        // Funciones adicionales para mejorar la experiencia
        window.secretario = window.secretario || {};
        
        // Funci√≥n para limpiar b√∫squeda
        window.secretario.limpiarBusqueda = function() {
            document.getElementById('searchPlate').value = '';
            document.getElementById('searchDate').value = '';
            document.getElementById('searchService').value = '';
            document.getElementById('searchResults').innerHTML = `
                <tr>
                    <td colspan="8" class="emptyState">
                        <i class="fas fa-search fa-2x mb-2 d-block"></i>
                        Use los filtros para buscar registros en el historial
                    </td>
                </tr>
            `;
            document.getElementById('searchResultsCount').textContent = '0';
        };

        // Funci√≥n para recargar datos
        window.secretario.cargarRegistrosDelDia = function() {
            if (window.secretario && window.secretario.cargarRegistrosDelDia) {
                window.secretario.cargarRegistrosDelDia();
            }
        };

        // Mejorar accesibilidad con atajos de teclado
        document.addEventListener('keydown', function(e) {
            // Ctrl + S para guardar formulario
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                const activeTab = document.querySelector('.tab-pane.active');
                if (activeTab && activeTab.id === 'registerPanel') {
                    document.getElementById('serviceForm').dispatchEvent(new Event('submit'));
                }
            }
            
            // Ctrl + F para enfocar b√∫squeda
            if (e.ctrlKey && e.key === 'f') {
                const activeTab = document.querySelector('.tab-pane.active');
                if (activeTab && activeTab.id === 'searchPanel') {
                    e.preventDefault();
                    document.getElementById('searchPlate').focus();
                }
            }
        });

        // Auto-guardar borrador del formulario
        let autoSaveTimeout;
        document.addEventListener('DOMContentLoaded', function() {
            const formFields = ['licensePlate', 'serviceCost', 'serviceNotes'];
            
            formFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.addEventListener('input', function() {
                        clearTimeout(autoSaveTimeout);
                        autoSaveTimeout = setTimeout(() => {
                            // Guardar borrador en localStorage
                            const draft = {};
                            formFields.forEach(id => {
                                const element = document.getElementById(id);
                                if (element && element.value) {
                                    draft[id] = element.value;
                                }
                            });
                            localStorage.setItem('secretario_draft', JSON.stringify(draft));
                        }, 2000); // Guardar despu√©s de 2 segundos de inactividad
                    });
                }
            });

            // Restaurar borrador al cargar la p√°gina
            const savedDraft = localStorage.getItem('secretario_draft');
            if (savedDraft) {
                try {
                    const draft = JSON.parse(savedDraft);
                    Object.keys(draft).forEach(fieldId => {
                        const field = document.getElementById(fieldId);
                        if (field && draft[fieldId]) {
                            field.value = draft[fieldId];
                        }
                    });
                } catch (error) {
                    console.warn('Error restaurando borrador:', error);
                }
            }

            // Limpiar borrador al enviar formulario exitosamente
            document.getElementById('serviceForm').addEventListener('submit', function() {
                setTimeout(() => {
                    localStorage.removeItem('secretario_draft');
                }, 1000);
            });
        });

        // Validaci√≥n en tiempo real
        document.addEventListener('DOMContentLoaded', function() {
            const licensePlateField = document.getElementById('licensePlate');
            if (licensePlateField) {
                licensePlateField.addEventListener('input', function() {
                    const value = this.value.toUpperCase();
                    this.value = value;
                    
                    // Validaci√≥n b√°sica de formato de placa
                    const isValid = value.length >= 3 && /^[A-Z0-9\-]+$/.test(value);
                    
                    if (value && !isValid) {
                        this.classList.add('is-invalid');
                        this.classList.remove('is-valid');
                    } else if (value && isValid) {
                        this.classList.add('is-valid');
                        this.classList.remove('is-invalid');
                    } else {
                        this.classList.remove('is-valid', 'is-invalid');
                    }
                });
            }

            const costField = document.getElementById('serviceCost');
            if (costField) {
                costField.addEventListener('input', function() {
                    const value = parseFloat(this.value);
                    
                    if (this.value && (isNaN(value) || value <= 0)) {
                        this.classList.add('is-invalid');
                        this.classList.remove('is-valid');
                    } else if (this.value && value > 0) {
                        this.classList.add('is-valid');
                        this.classList.remove('is-invalid');
                    } else {
                        this.classList.remove('is-valid', 'is-invalid');
                    }
                });
            }
        });

        // Confirmaci√≥n antes de salir si hay cambios no guardados
        let hasUnsavedChanges = false;

        document.addEventListener('DOMContentLoaded', function() {
            const formElements = document.querySelectorAll('#serviceForm input, #serviceForm select, #serviceForm textarea');
            
            formElements.forEach(element => {
                element.addEventListener('input', function() {
                    hasUnsavedChanges = true;
                });
            });

            document.getElementById('serviceForm').addEventListener('submit', function() {
                hasUnsavedChanges = false;
            });

            document.querySelector('button[type="reset"]').addEventListener('click', function() {
                hasUnsavedChanges = false;
            });
        });

        window.addEventListener('beforeunload', function(e) {
            if (hasUnsavedChanges) {
                e.preventDefault();
                e.returnValue = '¬øEst√° seguro de que desea salir? Los cambios no guardados se perder√°n.';
                return e.returnValue;
            }
        });

        // Funci√≥n para mostrar estad√≠sticas r√°pidas en el navbar
        function updateNavbarStats() {
            // Esta funci√≥n puede ser llamada por el sistema principal
            // para mostrar estad√≠sticas r√°pidas en tiempo real
        }

        // Detectar inactividad y mostrar recordatorio
        let inactivityTimer;
        let lastActivity = Date.now();

        function resetInactivityTimer() {
            lastActivity = Date.now();
            clearTimeout(inactivityTimer);
            
            inactivityTimer = setTimeout(() => {
                const timeSinceLastActivity = Date.now() - lastActivity;
                const minutesInactive = Math.floor(timeSinceLastActivity / (1000 * 60));
                
                if (minutesInactive >= 30) {
                    if (confirm(`Ha estado inactivo por ${minutesInactive} minutos. ¬øDesea continuar trabajando?`)) {
                        resetInactivityTimer();
                    } else {
                        window.location.href = 'login.html';
                    }
                }
            }, 30 * 60 * 1000); // 30 minutos
        }

        // Resetear timer en cualquier actividad del usuario
        ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart', 'click'].forEach(event => {
            document.addEventListener(event, resetInactivityTimer, true);
        });

        resetInactivityTimer();

        console.log('üéØ Panel de Secretario cargado correctamente');
        console.log('üì± Funcionalidades disponibles:');
        console.log('   ‚Ä¢ Registro de servicios con BD');
        console.log('   ‚Ä¢ B√∫squeda avanzada de historial');
        console.log('   ‚Ä¢ Cierre de caja diario automatizado');
        console.log('   ‚Ä¢ Exportaci√≥n de reportes');
        console.log('   ‚Ä¢ Auto-guardado de borradores');
        console.log('   ‚Ä¢ Validaci√≥n en tiempo real');
        console.log('   ‚Ä¢ Atajos de teclado (Ctrl+S, Ctrl+F)');
    </script>
</body>
</html>